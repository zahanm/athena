<!DOCTYPE html>
<html>
<head>
  <title>Karma</title>
  <link rel="stylesheet" href="/styles/index.css" type="text/css" charset="utf-8">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/scripts/bootstrap-dropdown.js" type="text/javascript" charset="utf-8"></script>
  <script src="/scripts/bootstrap-modal.js" type="text/javascript" charset="utf-8"></script>
  <script src="/scripts/dog.js" type="text/javascript" charset="utf-8"></script>
  <script>
    // Dialog click listeners 
    $(document).on("click", ".open-PairDialog", function () {
      $('#pairDialog').html(Mustache.render($('#pairDialog').html(), { first_name: $(this).data('id'), email: $(this).data('addr') }))
    });
    $(document).on("click", ".open-SuggestDialog", function () {
      $('#suggestDialog').html(Mustache.render($('#suggestDialog').html(), { first_name: $(this).data('id') }))
      var suggestfilter = document.getElementById('suggestfilter');
        suggestfilter && suggestfilter.addEventListener('keyup', function (ev) {
          var corpus = document.querySelectorAll('.suggest-grid > li');
          if (ev.target && ev.target.value) {
            console.log('search:', ev.target.value);
            var query = ev.target.value.split(/\s+/).join('|');
            var search = new RegExp('\\b(' + query + ')', 'i');
            Array.prototype.forEach.call(corpus, function (doc) {
              if (search.exec(doc.dataset && doc.dataset.meta)) {
                doc.style.display = 'list-item';
              } else {
                doc.style.display = 'none';
              }
            });
          } else {
            console.log('clear search');
            Array.prototype.forEach.call(corpus, function (doc) {
              doc.style.display = 'list-item';
            });
          }});
    });
    $(document).on("click", ".suggest-preview", function () {
      $('input#suggestName').text($(this).data('fbid'))
      // remove selection style and highlight new element
      var els = document.querySelector('.suggest-grid').getElementsByTagName('li');
      for(i=0;i<els.length;i++){
        els[i].className = 'suggest-preview well';
      }
      this.className = 'suggest-preview well suggest-select';
    });
  </script>
</head>
<body>
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="brand" href="/">
          Karma
        </a>
        <ul class="nav">
          <li><a href="/">Profile</a></li>
          <li class="active"><a href="/browse.html">Browse</a></li>
        </ul>
        <ul class="nav pull-right" dogjs-auth="true">
          <li><a href="/dog/account/logout">Logout</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Alerts and Dialogs -->
  <div id="thanks-pairing" class="toast row" style="display: none;">
    <div>
      <h1>Thank you</h1>
      <p>We will pass along your suggestion.</p>
    </div>
  </div>

  <!--<div class="alert alert-block" id="pairDialog">
    <button type="button" class="close" data-dismiss="alert">×</button>
    <h4>Warning!</h4>
    Best check yo self, you're not...
  </div>-->

  <div class="modal hide fade" id="pairDialog" style="display: none; width: 300px; margin-top: -100px; margin-left: -150px">
    <div class="modal-body" align="center">
      <a href="#" class="close" id="closePairDialog" data-dismiss="modal">×</a>
      <div class="btn-group btn-group-vertical">
        <button class="btn">I want to learn from {{first_name}}</button>
        <button class="btn">I want to teach {{first_name}}</button>
        <a class="btn btn-info" href="mailto:{{email}}" style="width: inherit;">Contact</a>
			</div>
		</div>
  </div>

  <div class="modal hide fade" id="suggestDialog" style="display: none; ">
    <div class="modal-header">
      <a href="#" class="close" data-dismiss="modal">×</a>
      <h1 id="title" style="display: inline-block">
        Match
        <!--Insert spinner for teacher/student-->
        <small>
          Find a
          <select class="well" style="margin-bottom: 0px;">
            <option>teacher</option>
            <option>student</option>
          </select>
          for {{first_name}}
        </small>
      </h1>
		</div>
    <div class="modal-body">
      <!-- People container -->
      <div style="height: 100px; margin-bottom: 100px;">
        <form class="span6">
          <ul class="suggest-grid" method="append"></ul>
        </form>
      </div>
		</div>
    <div class="modal-footer" style="text-align: left;">
      <form class="form-search">
        <input type="text" class="search-query" id="suggestfilter" placeholder="Search">
        <input id="suggestName" type="hidden">{{suggest_name}}</input>
        <button class="btn btn-info" style="float: right; margin-left: 10px;">Suggest</button>
        <button class="btn" style="float: right;">Cancel</button>
      </form>
    </div>
  </div>

  <!-- People container -->
  <div class="container" style="margin-bottom: 100px;">
    <div class="page-header">
      <h1 style="display: inline-block;">
        Browse
        <small>Some people from your network</small>
      </h1>
      <form class="form-search pull-right">
        <input type="text" class="search-query" id="peoplefilter" placeholder="Search: people, goals, skills">
      </form>
    </div>
    <div class="span12">
      <ul class="thumbnails people-grid" method="append"></ul>
    </div>
  </div>
  <script src="/scripts/browse.js" type="text/javascript" charset="utf-8"></script>
</body>
</html>
